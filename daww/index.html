<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>Infinit DAW</title>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content: https://ssl.gstatic.com https://cdn.tailwindcss.com https://fonts.googleapis.com https://fonts.gstatic.com https://www.gstatic.com https://cdnjs.cloudflare.com; style-src * 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src * 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://www.gstatic.com https://cdnjs.cloudflare.com;">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="css/mixer.css">
    </head>
<body class="bg-gray-900 text-white flex flex-col h-full overflow-hidden pl-safe pr-safe pt-safe pb-safe">

    <div id="clip-context-menu" class="context-menu">
        <div id="context-split" class="context-menu-item">Dividir</div>
        <div id="context-copy" class="context-menu-item">Copiar</div>
        <div id="context-delete" class="context-menu-item">Excluir</div>
    </div>
    <div id="track-context-menu" class="context-menu">
        <div id="context-paste" class="context-menu-item">Colar</div>
    </div>
    
    <header class="bg-gray-800 p-2 flex items-center justify-between shadow-lg z-40 relative">
        <div class="flex items-center gap-3">
            <button id="hamburger-btn" class="p-1.5 rounded-md hover:bg-gray-700" title="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </button>
        </div>

        <div class="flex items-center space-x-1.5">
            <div id="user-display-name" class="text-sm text-gray-300 font-semibold hidden md:block mr-2">Carregando...</div>
            <button id="play-btn" class="p-1.5 rounded-md bg-green-600 hover:bg-green-700" title="Play"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path></svg></button>
            <button id="stop-btn" class="p-1.5 rounded-md bg-red-600 hover:bg-red-700" title="Stop" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"></path></svg></button>
            <button id="record-btn" class="p-1.5 rounded-md bg-red-700 hover:bg-red-800" title="Record"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 13A5 5 0 1 0 8 3a5 5 0 0 0 0 10z"></path></svg></button>
            <button id="snap-toggle-btn" class="control-btn p-1.5 rounded-md" title="Ligar/Desligar Ímã (Snap)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a7 7 0 0 0-7 7v1.362c0 .537.198 1.04.558 1.435l.36.36c.417.417.962.643 1.538.643h1.379a2.5 2.5 0 0 1 4.33 0h1.379c.576 0 1.121-.226 1.538-.643l.36-.36c.36-.395.558-.898.558-1.435V8a7 7 0 0 0-7-7zM6.5 4.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm3 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zM5 8.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"></svg></button>
            <button id="metronome-btn" class="control-btn p-1.5 rounded-md bg-gray-700 font-bold text-sm" title="Metrônomo">MET</button>
            <button id="loop-toggle-btn" class="control-btn p-1.5 rounded-md bg-gray-700 font-bold text-sm" title="Loop On/Off">LOOP</button>
            <button id="add-track-btn" class="bg-blue-600 hover:bg-blue-700 p-1.5 rounded-md text-xs font-semibold"><span class="sm:hidden">+</span><span class="hidden sm:inline">+ Trilha</span></button>
            <button id="import-audio-btn" class="bg-green-600 hover:bg-green-700 px-2 py-1.5 rounded-md text-xs font-semibold flex items-center" title="Importar Áudio para a trilha selecionada"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg><span class="hidden sm:inline ml-1">Importar</span></button>
            
            <a href="loja.html" id="beat-store-btn" class="bg-purple-600 hover:bg-purple-700 px-2 py-1.5 rounded-md text-xs font-semibold flex items-center" title="Acessar Loja de Beats">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0H15.5a.5.5 0 0 1 .5.5v.625a1.375 1.375 0 0 0-2.75 0 .5.5 0 0 1-1 0 1.375 1.375 0 0 0-2.75 0 .5.5 0 0 1-1 0 1.375 1.375 0 0 0-2.75 0 .5.5 0 0 1-1 0 1.375 1.375 0 0 0-2.75 0H.5a.5.5 0 0 1 .5-.5h2.19zM4.5 9a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5z"/>
                </svg>
                <span class="hidden sm:inline ml-1">Loja</span>
            </a>
        </div>
        
        <div id="main-menu" class="main-menu hidden">
            <a href="#" id="menu-new" class="main-menu-item">Novo Projeto</a>
            <a href="#" id="menu-open" class="main-menu-item">Abrir Projeto (.ifnt)</a>
            <a href="#" id="menu-save" class="main-menu-item">Salvar Projeto (.ifnt)</a>
            <a href="#" id="menu-export" class="main-menu-item">Exportar como WAV</a>
            <div class="main-menu-item flex items-center justify-between cursor-default">
                <label for="bpm" class="text-sm font-medium text-gray-300">BPM do Projeto:</label>
                <input type="number" id="bpm" class="bg-gray-800 text-white w-20 text-center font-mono rounded-md border border-gray-600 focus:outline-none focus:ring-1 focus:ring-purple-500 p-1">
            </div>
            <hr>
            <a href="#" id="menu-logout-btn" class="main-menu-item">Sair</a>
        </div>
    </header>
    
    <main class="flex-1 flex flex-col overflow-hidden">
        <div class="flex flex-shrink-0 h-12 border-b border-gray-700">
            <div class="w-36 flex-shrink-0 bg-gray-800 border-r border-gray-700">
                </div>
            <div id="ruler-container" class="flex-1 relative overflow-hidden bg-gray-800 cursor-pointer">
                <div id="ruler" class="h-full absolute top-0 left-0"></div>
            </div>
        </div>

        <div class="flex flex-1 overflow-hidden">
            <div id="track-headers-container" class="sync-scroll w-36 flex-shrink-0 bg-gray-800 overflow-y-auto overflow-x-hidden border-r border-gray-700">
                </div>
            
            <div id="timeline-scroll-container" class="sync-scroll flex-1 relative overflow-auto">
                <div id="timeline-content" class="relative">
                    <div class="grid-background"></div>
                    <div id="playhead"></div>
                    <div id="playhead-dragger"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="bottom-drawer">
        <div id="drawer-handle">
            <button id="drawer-mix-btn">MIX</button>
        </div>
        <div id="drawer-content">
            <div id="drawer-placeholder" class="h-full flex items-center justify-center text-gray-500"><p>Selecione uma trilha para ver seus controles.</p></div>
            <div id="drawer-track-controls" class="hidden h-full p-4 grid grid-cols-1 md:grid-cols-2 gap-x-8">
                <div class="space-y-4">
                    <h3 id="drawer-track-name" class="text-2xl font-bold text-white truncate" title="Nome da Trilha">Nome da Trilha</h3>
                    <div class="grid grid-cols-2 gap-x-4">
                        <div>
                            <label for="drawer-volume" class="font-semibold text-sm text-gray-400">Volume</label>
                            <input type="range" id="drawer-volume" min="0" max="1.5" step="0.01" value="1.0" class="w-full mt-1">
                        </div>
                        <div>
                            <label for="drawer-pan" class="font-semibold text-sm text-gray-400">Pan</label>
                            <input type="range" id="drawer-pan" min="-100" max="100" value="0" class="w-full mt-1">
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button id="drawer-mute-btn" class="control-btn flex-1 py-2 rounded-md font-bold text-sm bg-gray-600 hover:bg-red-500 transition-colors text-white">MUTE</button>
                        <button id="drawer-solo-btn" class="control-btn flex-1 py-2 rounded-md font-bold text-sm bg-gray-600 hover:bg-yellow-500 transition-colors text-white">SOLO</button>
                    </div>
                    <div id="microphone-selector-container" class="space-y-2 hidden">
                        <label for="microphone-select" class="font-semibold text-sm text-gray-400">Selecionar Microfone:</label>
                        <select id="microphone-select" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </select>
                    </div>
                    </div>
                <div class="flex flex-col">
                    <h4 class="font-semibold text-sm text-gray-400 mb-2">Cadeia de Efeitos (Inserts)</h4>
                    <div id="drawer-effects-chain" class="flex-1 flex flex-col gap-2 p-2 bg-gray-900/50 rounded-md min-h-[80px] border border-gray-700">
                        <p class="text-xs text-gray-500">Nenhum efeito adicionado.</p>
                    </div>
                    <button id="drawer-effects-btn" class="w-full mt-3 flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 py-2 rounded-md font-bold text-sm text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/></svg>
                        <span>Adicionar Efeito</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="effects-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]">
        <div id="effects-modal-content" class="bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-4xl flex flex-col" style="height: 80vh;">
            <header class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0">
                <h2 class="text-xl font-bold">Seletor de Efeitos</h2>
                <button id="effects-modal-close-btn" class="text-gray-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button>
            </header>
            <div class="p-4 border-b border-gray-700 flex-shrink-0">
                <div class="flex flex-col md:flex-row gap-4">
                    <input type="search" id="effects-search-input" placeholder="Pesquisar efeitos..." class="flex-grow bg-gray-700 text-white rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <div id="effects-modal-filters" class="flex-shrink-0 flex items-center flex-wrap gap-2"></div>
                </div>
            </div>
            <main id="effects-modal-grid" class="flex-1 p-4 overflow-y-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></main>
        </div>
    </div>

    <div id="parameter-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[110]">
        <div class="bg-gray-800 rounded-lg shadow-xl w-[56rem] max-w-[90vw] h-auto max-h-[85vh] flex flex-col">
            <header class="flex items-center justify-between p-4 border-b border-gray-700"><h2 id="parameter-editor-title" class="text-xl font-bold">Editar Efeito</h2><button id="parameter-editor-close-btn" class="text-gray-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button></header>
            <div class="flex-1 overflow-y-auto"><main id="parameter-editor-body" class="p-6 space-y-4"></main><div id="parameter-editor-specific-ui-container"></div></div>
        </div>
    </div>
    
    <div id="export-loader" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[120]"><div class="text-white text-center"><div class="spinner animate-spin rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 mx-auto"></div><p class="text-lg font-semibold">Processando seu projeto...</p><p>Isso pode levar alguns instantes.</p></div></div>

    <div id="mixer-drawer">
        <header class="mixer-header">
            <h2>Mesa de Mixagem</h2>
            <button id="close-mixer-btn" class="close-mixer-btn">Fechar</button>
        </header>
        <div id="mixer-channels-container" class="mixer-main-container">
        </div>
    </div>

    <input type="file" id="audio-file-input" class="hidden" accept="audio/*">

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script src="js/01_state.js"></script>
    <script src="js/02_dom.js"></script>
    <script src="js/03_ruler.js"></script>
    <script src="js/04_tracks.js"></script>
    <script src="js/05_playhead.js"></script>
    <script src="js/06_clipEditing.js"></script>
    <script src="js/07_contextMenus.js"></script>
    <script src="js/08_controls.js"></script>
    <script src="js/09_dragAndDrop.js"></script>
    <script src="js/12_waveform.js"></script>
    <script src="js/19_metronome.js"></script>
    <script src="js/16_effectsFactory.js"></script>
    <script src="js/14_effectsModal.js"></script> <script src="js/15_parameterEditor.js"></script> <script src="js/11_drawer.js"></script>
    <script src="js/13_audioEngine.js"></script>
    <script src="js/20_recording.js"></script>
    <script src="js/21_exporter.js"></script>
    <script src="js/22_projectManager.js"></script>
    <script src="js/23_featureGating.js"></script>
    <script src="js/10_main.js"></script>

</body>
</html>